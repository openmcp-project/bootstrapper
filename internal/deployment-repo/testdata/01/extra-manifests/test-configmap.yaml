apiVersion: v1
kind: ConfigMap
metadata:
    name: test-configmap
    namespace: default
data:
  userProvided: |
{{ toYaml .Values.user | indent 4 }}
  key: "value"
  repository: "{{ getOCMRepository }}"
  rootComponent: "{{ dig "component" "name" "none" (componentVersionAsMap (getRootComponentVersion)) }}"
  {{- $releaseChannelCv := getComponentVersionByReference "releasechannel"  }}
  {{- $crossplaneCv := getComponentVersionByReference $releaseChannelCv "crossplane"  }}
  {{- $crossplaneImageResource := getResourceFromComponentVersion $crossplaneCv "image-crossplane" }}
  {{- $imageReference := dig "access" "imageReference" "none" $crossplaneImageResource }}
  {{- $parsedImage := parseImage $imageReference }}
  {{- $crossplaneCvMap := componentVersionAsMap $crossplaneCv }}
  crossplaneComponentName: "{{ dig "component" "name" "none" $crossplaneCvMap }}"
  crossplaneComponentVersion: "{{ dig "component" "version" "none" $crossplaneCvMap }}"
  crossplaneImage: "{{ dig "image" "none" $parsedImage }}"
  crossplaneVersions: |
  {{- $crossplaneVersions := listComponentVersions $crossplaneCv }}
{{ toYaml (sortAlpha $crossplaneVersions) | indent 4 }}
  platformService: |
  {{- $platformServiceCv := getComponentVersionForResource "platform-service-test-image" }}
  {{- $platformServiceImageResource := getResourceFromComponentVersion $platformServiceCv "platform-service-test-image" }}
  {{- $platformServiceImageReference := dig "access" "imageReference" "none" $platformServiceImageResource }}
  {{- $platformServiceParsedImage := parseImage $platformServiceImageReference }}
    image: "{{ dig "image" "none" $platformServiceParsedImage }}"
    version: "{{ $platformServiceImageResource.version }}"